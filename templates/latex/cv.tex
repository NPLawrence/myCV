\documentclass[12pt]{moderncv}
\DeclareOldFontCommand{\rm}{\normalfont\rmfamily}{\mathrm}
\DeclareOldFontCommand{\sf}{\normalfont\sffamily}{\mathsf}
\DeclareOldFontCommand{\tt}{\normalfont\ttfamily}{\mathtt}
\DeclareOldFontCommand{\bf}{\normalfont\bfseries}{\mathbf}
\DeclareOldFontCommand{\it}{\normalfont\itshape}{\mathit}
\DeclareOldFontCommand{\sl}{\normalfont\slshape}{\@nomath\sl}
\DeclareOldFontCommand{\sc}{\normalfont\scshape}{\@nomath\sc}
\DeclareRobustCommand*\cal{\@fontswitch\relax\mathcal}
\DeclareRobustCommand*\mit{\@fontswitch\relax\mathnormal}


\definecolor{tab_highlight}{HTML}{f0c967}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

%\renewcommand*{\namefont}{\fontsize{24}{26}\mdseries\upshape}
%\renewcommand*{\\sectionfont}{\fontsize{24}{26}\mdseries\upshape}


\moderncvstyle{<< style >>}
\moderncvcolor{<< color >>}
\definecolor{color2}{rgb}{<<color2>>}
%\renewcommand{\familydefault}{\sfdefault}

\usepackage[top=.75in, bottom=.75in, left=.75in, right=.75in]{geometry}
\usepackage{needspace}
\usepackage{fontawesome}
%\usepackage[margin=1in]{geometry}

%\usepackage[scale=0.8]{geometry}
\recomputelengths
%\setlength{\hintscolumnwidth}{3cm}
%\setlength{\makecvtitlenamewidth}{10cm}


% \usepackage{ragged2e}
% \newcolumntype{R}[1]{>{\RaggedLeft\hspace{0pt}}p{#1}}

\usepackage{mathabx}



% \usepackage[backend=biber,style=ieee,defernumbers=true]{biblatex}
% \usepackage[
% backend=biber,style=publist,
% sorting=ydmdnt,
% %plauthorhandling=highlight,
% % marginyear=true,
% plnumbered=false,
% maxnames=10,
% nameorder=given-family
% ]{biblatex}

% Make the author's name bold in publications.
% \DeclareNameFormat{author}{%
%   \nameparts{#1}%
%   \ifthenelse{\equal{\namepartfamily}{Lawrence}\or\equal{\namepartfamily}{Lawrence*}}%
%     {\textbf{\ifblank{\namepartgiveni}{}{\namepartgiveni\space}\namepartfamily}}%
%     {\ifblank{\namepartgiveni}{}{\namepartgiveni\space}\namepartfamily}%
%   \ifthenelse{\value{listcount}=1 \AND \value{liststop}=2}%
%     {\space and\space}
%     {\ifthenelse{\value{listcount}<\value{liststop}}%
%       {\addcomma\space}
%       {}
%     }
% }
% Old, broken:
% \DeclareNameFormat{author}{%
%   \ifthenelse{\equal{#1}{<< name.last >>}}%
%     {\textbf{\ifblank{#4}{}{#4\space}#1}}%
%     {\ifblank{#4}{}{#4\space}#1}%
%   \ifthenelse{\value{listcount}=1 \AND \value{liststop}=2}%
%     {\space and\space}
%     {\ifthenelse{\value{listcount}<\value{liststop}}%
%       {\addcomma\space}
%       {}
%     }
% }

\usepackage{lastpage}
\cfoot{\addressfont\textcolor{gray}{\hypersetup{allcolors=gray}Page \thepage\ of \pageref{LastPage}}}

\AtEndPreamble{\hypersetup{pdftitle={CV--<< name.first >> << name.last >>}}}
%\AtEndPreamble{\hypersetup{pdftitle={<< name.first >> << name.last >>: CV}, allcolors=color1, colorlinks}}

\name{<< name.first >>}{<< name.last >>}
%\title{Resum√© title}
\address{1984 Mathematics Rd.}{V6T 1Z2 Vancouver, BC}{Canada}
\phone{<< phone >>}
\email{<< email >>}
\homepage{<< url >>}
%\social[github]{<<social.github>>}
\extrainfo{\small Last updated on \today}
%\photo[64pt][0.4pt]{picture}
% \quote{Generated on \today}

\AtBeginDocument{\hypersetup{colorlinks}}


%%%% MODIFYING CV template
\usepackage{dashrule}
%\usepackage{tikz}
\usepackage{xpatch}
\xpatchcmd{\cventry}{.\strut}{\strut}{}{}

\frenchspacing


% https://tex.stackexchange.com/questions/566210/moderncv-shorten-the-horizontal-line-in-sections
\makeatletter
\RenewDocumentCommand{\section}{sm}{%
  \par\addvspace{2.5ex}%
  \phantomsection{}% reset the anchor for hyperrefs
  \addcontentsline{toc}{section}{#2}%
  \cvitem[0ex]{\strut\raggedleft\raisebox{\baseletterheight}{\color{gray}\rule{\hintscolumnwidth}{0.95ex}}}{\strut\sectionstyle{{\bf\Large#2}}}%
  \par\nobreak\addvspace{1ex}\@afterheading}% to avoid a pagebreak after the heading
\makeatother

\makeatletter
\RenewDocumentCommand{\subsection}{sm}{%
  \par\addvspace{1.5ex}%
  \phantomsection{}% reset the anchor for hyperrefs
  \addcontentsline{toc}{subsection}{#2}%
  \cvitem[0ex]{}{\strut\sectionstyle{{\bf\large#2}}}%
  \par\nobreak\addvspace{1ex}\@afterheading}% to avoid a pagebreak after the heading
\makeatother



\sethintscolumnlength{2cm}
\pagenumbering{gobble}
\begin{document}
\hypersetup{allcolors=color1}
%\makecvtitle

%\bigskip
%{\obeylines\setlength{\parskip}{0pt}
%{\bfseries {<< name.first >> << name.last >>}}
%\today
%Postdoctoral Fellow\\<< phone >>\\<< email >>
%}

\begin{center}
{<< name.first >> << name.last >>} \\
\smallskip
{\addressfont\textcolor{gray}\today}
\end{center}

\bigskip

%Department of Mathematics \hfill << phone >>\\
%1984 Mathematics Rd.\\
%Vancouver, BC V6T 1Z2 \\
%Canada

~< block body >~
\noindent\vbox{\hsize 50truemm\normalsize
\parskip=0pt
\par Department of Mathematics
\par 1984 Mathematics Road
\par Vancouver, BC V6T 1Z2
\par \phantom{0}
}
\hfill \vbox{\hsize 50truemm\normalsize
\parskip=0pt
\par  {\small\faPhone}\vspace{1.5mm} << phone >>
\par  {\small\faEnvelopeO}\vspace{1.5mm} {\ttfamily << email >>}
\par  {\small\faDesktop}\vspace{1.5mm} {\ttfamily\href{<< url >>}{<< url_text >>}}
}
~< endblock body >~

%\vspace{-1cm}

<< body >>

\end{document}
